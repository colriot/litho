<!doctype html>
<html lang="en">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width,initial-scale=1">
<meta name="generator" content="Docusaurus v2.0.0-alpha.63">
<link rel="search" type="application/opensearchdescription+xml" title="Litho" href="/opensearch.xml"><title data-react-helmet="true">Advanced: Writing your own DiffSection | Litho</title><meta data-react-helmet="true" name="docsearch:version" content="current,latest"><meta data-react-helmet="true" name="twitter:card" content="summary_large_image"><meta data-react-helmet="true" property="og:title" content="Advanced: Writing your own DiffSection | Litho"><meta data-react-helmet="true" name="description" content="In this document we will describe how to build your own DiffSection. The Sections API already provides two implementations that cover most frequent use cases in SingleComponentSection and DataDiffSection. You should write your own DiffSection if the given implementations do not suffice for your use case, as the complexity and chances of introducing subtle errors are both high."><meta data-react-helmet="true" property="og:description" content="In this document we will describe how to build your own DiffSection. The Sections API already provides two implementations that cover most frequent use cases in SingleComponentSection and DataDiffSection. You should write your own DiffSection if the given implementations do not suffice for your use case, as the complexity and chances of introducing subtle errors are both high."><meta data-react-helmet="true" property="og:url" content="https://fblitho.com/docs/sections/diff-sections"><link data-react-helmet="true" rel="shortcut icon" href="/images/favicon.png"><link data-react-helmet="true" rel="preconnect" href="https://BH4D9OD16A-dsn.algolia.net" crossorigin="true"><link data-react-helmet="true" rel="canonical" href="https://fblitho.com/docs/sections/diff-sections"><link rel="stylesheet" href="/styles.ff777cc8.css">
<link rel="stylesheet" href="/main.df971a24.css">
<link rel="preload" href="/styles.9856b768.js" as="script">
<link rel="preload" href="/runtime~main.3b77bac1.js" as="script">
<link rel="preload" href="/main.dad78cf1.js" as="script">
<link rel="preload" href="/1.bb7fa744.js" as="script">
<link rel="preload" href="/2.9388d11f.js" as="script">
<link rel="preload" href="/101.46985c7a.js" as="script">
<link rel="preload" href="/104.bb474256.js" as="script">
<link rel="preload" href="/935f2afb.e9c270b9.js" as="script">
<link rel="preload" href="/17896441.e778f366.js" as="script">
<link rel="preload" href="/2df85be4.165ba088.js" as="script">
</head>
<body>
<script>!function(){function t(t){document.documentElement.setAttribute("data-theme",t)}var e=function(){var t=null;try{t=localStorage.getItem("theme")}catch(t){}return t}();t(null!==e?e:"light")}()</script>
<div style="display: none; text-align: center; background-color: white; color: black;" id="internaldocs-banner"></div><div id="__docusaurus">
<nav class="navbar navbar--light navbar--fixed-top"><div class="navbar__inner"><div class="navbar__items"><div aria-label="Navigation bar toggle" class="navbar__toggle" role="button" tabindex="0"><svg xmlns="http://www.w3.org/2000/svg" width="30" height="30" viewBox="0 0 30 30" role="img" focusable="false"><title>Menu</title><path stroke="currentColor" stroke-linecap="round" stroke-miterlimit="10" stroke-width="2" d="M4 7h22M4 15h22M4 23h22"></path></svg></div><a class="navbar__brand" href="/"><img class="navbar__logo" src="/images/logo.svg" alt="Litho Logo"><strong class="navbar__title">Litho</strong></a></div><div class="navbar__items navbar__items--right"><a class="navbar__item navbar__link" href="/docs/intro/motivation">Docs</a><a href="/javadoc" target="_blank" rel="noopener noreferrer" class="navbar__item navbar__link">API</a><a class="navbar__item navbar__link" href="/docs/tutorial/overview">Tutorial</a><a href="https://github.com/facebook/litho" target="_blank" rel="noopener noreferrer" class="navbar__item navbar__link">GitHub</a><button type="button" class="DocSearch DocSearch-Button" aria-label="Search"><svg width="20" height="20" class="DocSearch-Search-Icon" viewBox="0 0 20 20"><path d="M14.386 14.386l4.0877 4.0877-4.0877-4.0877c-2.9418 2.9419-7.7115 2.9419-10.6533 0-2.9419-2.9418-2.9419-7.7115 0-10.6533 2.9418-2.9419 7.7115-2.9419 10.6533 0 2.9419 2.9418 2.9419 7.7115 0 10.6533z" stroke="currentColor" fill="none" fill-rule="evenodd" stroke-linecap="round" stroke-linejoin="round"></path></svg><span class="DocSearch-Button-Placeholder">Search</span><span class="DocSearch-Button-Key">⌘</span><span class="DocSearch-Button-Key">K</span></button></div></div><div role="presentation" class="navbar-sidebar__backdrop"></div><div class="navbar-sidebar"><div class="navbar-sidebar__brand"><a class="navbar__brand" href="/"><img class="navbar__logo" src="/images/logo.svg" alt="Litho Logo"><strong class="navbar__title">Litho</strong></a></div><div class="navbar-sidebar__items"><div class="menu"><ul class="menu__list"><li class="menu__list-item"><a class="menu__link" href="/docs/intro/motivation">Docs</a></li><li class="menu__list-item"><a href="/javadoc" target="_blank" rel="noopener noreferrer" class="menu__link">API</a></li><li class="menu__list-item"><a class="menu__link" href="/docs/tutorial/overview">Tutorial</a></li><li class="menu__list-item"><a href="https://github.com/facebook/litho" target="_blank" rel="noopener noreferrer" class="menu__link">GitHub</a></li></ul></div></div></div></nav><div class="main-wrapper"><div class="docPage_2gpo"><div class="docSidebarContainer_3_JD" role="complementary"><div class="sidebar_2urC"><div class="menu menu--responsive menu_5FrY"><button aria-label="Open Menu" aria-haspopup="true" class="button button--secondary button--sm menu__button" type="button"><svg aria-label="Menu" class="sidebarMenuIcon_Dm3K" xmlns="http://www.w3.org/2000/svg" height="24" width="24" viewBox="0 0 32 32" role="img" focusable="false"><title>Menu</title><path stroke="currentColor" stroke-linecap="round" stroke-miterlimit="10" stroke-width="2" d="M4 7h22M4 15h22M4 23h22"></path></svg></button><ul class="menu__list"><li class="menu__list-item menu__list-item--collapsed"><a class="menu__link menu__link--sublist" href="#!">What is Litho?</a><ul class="menu__list"><li class="menu__list-item"><a class="menu__link" tabindex="-1" href="/docs/intro/motivation">Motivation</a></li><li class="menu__list-item"><a class="menu__link" tabindex="-1" href="/docs/intro/built-with-litho">Built with Litho</a></li></ul></li><li class="menu__list-item menu__list-item--collapsed"><a class="menu__link menu__link--sublist" href="#!">Tutorial</a><ul class="menu__list"><li class="menu__list-item"><a class="menu__link" tabindex="-1" href="/docs/tutorial/overview">Overview</a></li><li class="menu__list-item"><a class="menu__link" tabindex="-1" href="/docs/tutorial/project-setup">Setting up the project</a></li><li class="menu__list-item"><a class="menu__link" tabindex="-1" href="/docs/tutorial/first-components">Components and Props</a></li><li class="menu__list-item"><a class="menu__link" tabindex="-1" href="/docs/tutorial/adding-state">Adding State</a></li><li class="menu__list-item"><a class="menu__link" tabindex="-1" href="/docs/tutorial/handling-events">Handling Events</a></li><li class="menu__list-item"><a class="menu__link" tabindex="-1" href="/docs/tutorial/building-lists">Building Lists</a></li></ul></li><li class="menu__list-item menu__list-item--collapsed"><a class="menu__link menu__link--sublist" href="#!">Main Concepts</a><ul class="menu__list"><li class="menu__list-item menu__list-item--collapsed"><a class="menu__link menu__link--sublist" href="#!" tabindex="-1">UI Composition</a><ul class="menu__list"><li class="menu__list-item"><a class="menu__link" tabindex="-1" href="/docs/mainconcepts/uicomposition/layout-specs">Layout Specs</a></li><li class="menu__list-item"><a class="menu__link" tabindex="-1" href="/docs/mainconcepts/uicomposition/mount-specs">Mount Specs</a></li><li class="menu__list-item"><a class="menu__link" tabindex="-1" href="/docs/mainconcepts/uicomposition/flexbox-yoga">Layout System with Flexbox</a></li></ul></li><li class="menu__list-item menu__list-item--collapsed"><a class="menu__link menu__link--sublist" href="#!" tabindex="-1">Coordinating State and Actions</a><ul class="menu__list"><li class="menu__list-item"><a class="menu__link" tabindex="-1" href="/docs/mainconcepts/coordinate-state-actions/state-overview">State Overview</a></li><li class="menu__list-item"><a class="menu__link" tabindex="-1" href="/docs/mainconcepts/coordinate-state-actions/hoisting-state">Hoisting State</a></li><li class="menu__list-item"><a class="menu__link" tabindex="-1" href="/docs/mainconcepts/coordinate-state-actions/events">Events Overview</a></li><li class="menu__list-item"><a class="menu__link" tabindex="-1" href="/docs/mainconcepts/coordinate-state-actions/trigger-events">Triggering events with Handles</a></li><li class="menu__list-item"><a class="menu__link" tabindex="-1" href="/docs/mainconcepts/coordinate-state-actions/treeprops">TreeProps</a></li><li class="menu__list-item"><a class="menu__link" tabindex="-1" href="/docs/mainconcepts/coordinate-state-actions/componenttree">ComponentTree</a></li><li class="menu__list-item"><a class="menu__link" tabindex="-1" href="/docs/mainconcepts/coordinate-state-actions/dynamic-props">Dynamic Props</a></li></ul></li></ul></li><li class="menu__list-item"><a class="menu__link menu__link--sublist menu__link--active" href="#!">Building lists</a><ul class="menu__list"><li class="menu__list-item"><a class="menu__link" tabindex="0" href="/docs/sections/start">Basics: DiffSection and GroupSection</a></li><li class="menu__list-item"><a class="menu__link" tabindex="0" href="/docs/sections/recycler-collection-component">Adding and adapting RecyclerCollection to your App</a></li><li class="menu__list-item"><a class="menu__link" tabindex="0" href="/docs/sections/best-practices">Best Practices and Performance</a></li><li class="menu__list-item"><a class="menu__link" tabindex="0" href="/docs/sections/hscrolls">Nested scrolling and measurement</a></li><li class="menu__list-item"><a class="menu__link" tabindex="0" href="/docs/sections/api-overview">API 📄: annotations, events and lifecycles</a></li><li class="menu__list-item"><a class="menu__link" tabindex="0" href="/docs/sections/working-ranges">Advanced: Prefetch and pagination</a></li><li class="menu__list-item"><a class="menu__link" tabindex="0" href="/docs/sections/services">Advanced: Granular Dependency Injection</a></li><li class="menu__list-item"><a class="menu__link" tabindex="0" href="/docs/sections/view-support">Advanced: Mixing with Android Views</a></li><li class="menu__list-item"><a aria-current="page" class="menu__link menu__link--active active" tabindex="0" href="/docs/sections/diff-sections">Advanced: Writing your own DiffSection</a></li><li class="menu__list-item"><a class="menu__link" tabindex="0" href="/docs/sections/architecture">Internal 🏗: Sections implementation architecture</a></li></ul></li><li class="menu__list-item menu__list-item--collapsed"><a class="menu__link menu__link--sublist" href="#!">Widgets</a><ul class="menu__list"><li class="menu__list-item"><a class="menu__link" tabindex="-1" href="/docs/widgets/builtin-widgets">Built-in widgets</a></li></ul></li><li class="menu__list-item menu__list-item--collapsed"><a class="menu__link menu__link--sublist" href="#!">Developer Tools</a><ul class="menu__list"><li class="menu__list-item"><a class="menu__link" tabindex="-1" href="/docs/devtools/android-studio-plugin">Android Studio Plugin</a></li><li class="menu__list-item"><a class="menu__link" tabindex="-1" href="/docs/devtools/flipper-plugins">Flipper Plugins</a></li></ul></li><li class="menu__list-item menu__list-item--collapsed"><a class="menu__link menu__link--sublist" href="#!">Testing</a><ul class="menu__list"><li class="menu__list-item"><a class="menu__link" tabindex="-1" href="/docs/testing/testing-overview">Introduction</a></li><li class="menu__list-item menu__list-item--collapsed"><a class="menu__link menu__link--sublist" href="#!" tabindex="-1">Unit Tests</a><ul class="menu__list"><li class="menu__list-item"><a class="menu__link" tabindex="-1" href="/docs/testing/unit-testing">Getting Started</a></li><li class="menu__list-item"><a class="menu__link" tabindex="-1" href="/docs/testing/subcomponent-testing">Sub-Component Testing</a></li><li class="menu__list-item"><a class="menu__link" tabindex="-1" href="/docs/testing/prop-matching">Matching @Prop</a></li><li class="menu__list-item"><a class="menu__link" tabindex="-1" href="/docs/testing/testing-treeprops">Matching @TreeProp</a></li><li class="menu__list-item"><a class="menu__link" tabindex="-1" href="/docs/testing/injectprop-matching">Matching @InjectProp</a></li><li class="menu__list-item"><a class="menu__link" tabindex="-1" href="/docs/testing/event-handler-testing">Event Handler Testing</a></li><li class="menu__list-item"><a class="menu__link" tabindex="-1" href="/docs/testing/sections-testing">Testing Sections</a></li></ul></li><li class="menu__list-item menu__list-item--collapsed"><a class="menu__link menu__link--sublist" href="#!" tabindex="-1">UI Tests</a><ul class="menu__list"><li class="menu__list-item"><a class="menu__link" tabindex="-1" href="/docs/testing/espresso-testing">End-to-End Tests</a></li></ul></li><li class="menu__list-item"><a class="menu__link" tabindex="-1" href="/docs/testing/tests-in-android-studio">Testing in Android Studio</a></li></ul></li><li class="menu__list-item menu__list-item--collapsed"><a class="menu__link menu__link--sublist" href="#!">Animations</a><ul class="menu__list"><li class="menu__list-item"><a class="menu__link" tabindex="-1" href="/docs/animations/transition-basics">Animation basics</a></li><li class="menu__list-item"><a class="menu__link" tabindex="-1" href="/docs/animations/transition-types">Types of Transitions</a></li><li class="menu__list-item"><a class="menu__link" tabindex="-1" href="/docs/animations/transition-all-layout">Animating All Layout</a></li><li class="menu__list-item"><a class="menu__link" tabindex="-1" href="/docs/animations/transition-choreography">Customizing Transitions</a></li><li class="menu__list-item"><a class="menu__link" tabindex="-1" href="/docs/animations/transition-definitions">Advanced: More ways to define transitions</a></li><li class="menu__list-item"><a class="menu__link" tabindex="-1" href="/docs/animations/transition-key-types">Advanced: Transitions key scoping</a></li></ul></li><li class="menu__list-item menu__list-item--collapsed"><a class="menu__link menu__link--sublist" href="#!">Accessibility</a><ul class="menu__list"><li class="menu__list-item"><a class="menu__link" tabindex="-1" href="/docs/accessibility/accessibility-overview">Overview</a></li></ul></li><li class="menu__list-item menu__list-item--collapsed"><a class="menu__link menu__link--sublist" href="#!">Performance</a><ul class="menu__list"><li class="menu__list-item"><a class="menu__link" tabindex="-1" href="/docs/performance/analysing-performance">Analysing Performance</a></li><li class="menu__list-item"><a class="menu__link" tabindex="-1" href="/docs/performance/spotting-performance-regressions">Spotting Performance Regressions</a></li></ul></li><li class="menu__list-item menu__list-item--collapsed"><a class="menu__link menu__link--sublist" href="#!">Best Practices</a><ul class="menu__list"><li class="menu__list-item"><a class="menu__link" tabindex="-1" href="/docs/best-practices/immutability">Immutability</a></li><li class="menu__list-item"><a class="menu__link" tabindex="-1" href="/docs/best-practices/props-vs-state">Props vs. State</a></li><li class="menu__list-item"><a class="menu__link" tabindex="-1" href="/docs/best-practices/coding-style">Coding Style</a></li></ul></li><li class="menu__list-item menu__list-item--collapsed"><a class="menu__link menu__link--sublist" href="#!">Deep Dive</a><ul class="menu__list"><li class="menu__list-item menu__list-item--collapsed"><a class="menu__link menu__link--sublist" href="#!" tabindex="-1">Reconciliation</a><ul class="menu__list"><li class="menu__list-item"><a class="menu__link" tabindex="-1" href="/docs/deep-dive/reconciliation">Introduction</a></li><li class="menu__list-item"><a class="menu__link" tabindex="-1" href="/docs/deep-dive/reconciliation/enabling-reconciliation">Enabling Reconciliation</a></li></ul></li><li class="menu__list-item"><a class="menu__link" tabindex="-1" href="/docs/deep-dive/incremental-mount">Incremental Mount</a></li></ul></li><li class="menu__list-item menu__list-item--collapsed"><a class="menu__link menu__link--sublist" href="#!">[Old Not Reused Content]</a><ul class="menu__list"><li class="menu__list-item menu__list-item--collapsed"><a class="menu__link menu__link--sublist" href="#!" tabindex="-1">Introducing Litho</a><ul class="menu__list"><li class="menu__list-item"><a class="menu__link" tabindex="-1" href="/docs/intro">What is Litho?</a></li><li class="menu__list-item"><a class="menu__link" tabindex="-1" href="/docs/uses">Uses</a></li></ul></li><li class="menu__list-item menu__list-item--collapsed"><a class="menu__link menu__link--sublist" href="#!" tabindex="-1">Quick Start</a><ul class="menu__list"><li class="menu__list-item"><a class="menu__link" tabindex="-1" href="/docs/getting-started">Getting Started</a></li><li class="menu__list-item"><a class="menu__link" tabindex="-1" href="/docs/tutorial">Tutorial</a></li><li class="menu__list-item"><a class="menu__link" tabindex="-1" href="/docs/writing-components">Writing Components</a></li><li class="menu__list-item"><a class="menu__link" tabindex="-1" href="/docs/using-components">Using Components</a></li></ul></li><li class="menu__list-item menu__list-item--collapsed"><a class="menu__link menu__link--sublist" href="#!" tabindex="-1">Reference</a><ul class="menu__list"><li class="menu__list-item"><a class="menu__link" tabindex="-1" href="/docs/props">Props</a></li><li class="menu__list-item"><a class="menu__link" tabindex="-1" href="/docs/common-props">Common Props</a></li><li class="menu__list-item"><a class="menu__link" tabindex="-1" href="/docs/cached-values">Cached Values</a></li></ul></li><li class="menu__list-item menu__list-item--collapsed"><a class="menu__link menu__link--sublist" href="#!" tabindex="-1">Handling Events</a><ul class="menu__list"><li class="menu__list-item"><a class="menu__link" tabindex="-1" href="/docs/events-touch-handling">Touch Handling</a></li><li class="menu__list-item"><a class="menu__link" tabindex="-1" href="/docs/visibility-handling">Visibility Handling</a></li></ul></li><li class="menu__list-item menu__list-item--collapsed"><a class="menu__link menu__link--sublist" href="#!" tabindex="-1">Sections</a><ul class="menu__list"><li class="menu__list-item"><a class="menu__link" tabindex="-1" href="/docs/sections-tutorial">Sections Tutorial</a></li><li class="menu__list-item"><a class="menu__link" tabindex="-1" href="/docs/communicating-with-the-ui">Scrolling and communicating with the UI</a></li></ul></li><li class="menu__list-item menu__list-item--collapsed"><a class="menu__link menu__link--sublist" href="#!" tabindex="-1">Common use cases</a><ul class="menu__list"><li class="menu__list-item"><a class="menu__link" tabindex="-1" href="/docs/updating-ui">Updating the UI</a></li><li class="menu__list-item"><a class="menu__link" tabindex="-1" href="/docs/borders">Borders</a></li><li class="menu__list-item"><a class="menu__link" tabindex="-1" href="/docs/tooltips">Tooltips</a></li><li class="menu__list-item"><a class="menu__link" tabindex="-1" href="/docs/saving-state">Saving state on rotation</a></li></ul></li><li class="menu__list-item menu__list-item--collapsed"><a class="menu__link menu__link--sublist" href="#!" tabindex="-1">Compatibility</a><ul class="menu__list"><li class="menu__list-item"><a class="menu__link" tabindex="-1" href="/docs/styles">Styles</a></li><li class="menu__list-item"><a class="menu__link" tabindex="-1" href="/docs/rtl">RTL</a></li></ul></li><li class="menu__list-item menu__list-item--collapsed"><a class="menu__link menu__link--sublist" href="#!" tabindex="-1">Advanced Guides</a><ul class="menu__list"><li class="menu__list-item"><a class="menu__link" tabindex="-1" href="/docs/architecture-overview">Architecture Overview</a></li><li class="menu__list-item"><a class="menu__link" tabindex="-1" href="/docs/recycler-component">Recycler</a></li><li class="menu__list-item"><a class="menu__link" tabindex="-1" href="/docs/custom-layout">Custom Layout</a></li><li class="menu__list-item"><a class="menu__link" tabindex="-1" href="/docs/error-boundaries">Error Boundaries</a></li><li class="menu__list-item"><a class="menu__link" tabindex="-1" href="/docs/onattached-ondetached">OnAttached/OnDetached</a></li></ul></li><li class="menu__list-item menu__list-item--collapsed"><a class="menu__link menu__link--sublist" href="#!" tabindex="-1">Architecture</a><ul class="menu__list"><li class="menu__list-item"><a class="menu__link" tabindex="-1" href="/docs/codegen">Code Generation</a></li><li class="menu__list-item"><a class="menu__link" tabindex="-1" href="/docs/asynchronous-layout">Asynchronous Layout</a></li><li class="menu__list-item"><a class="menu__link" tabindex="-1" href="/docs/view-flattening">View Flattening</a></li><li class="menu__list-item"><a class="menu__link" tabindex="-1" href="/docs/recycling">Recycling</a></li></ul></li><li class="menu__list-item menu__list-item--collapsed"><a class="menu__link menu__link--sublist" href="#!" tabindex="-1">Experimental</a><ul class="menu__list"><li class="menu__list-item"><a class="menu__link" tabindex="-1" href="/docs/mount-extensions">Mount Extensions</a></li></ul></li><li class="menu__list-item menu__list-item--collapsed"><a class="menu__link menu__link--sublist" href="#!" tabindex="-1">Additional Resources</a><ul class="menu__list"><li class="menu__list-item"><a class="menu__link" tabindex="-1" href="/docs/faq">FAQ</a></li><li class="menu__list-item"><a class="menu__link" tabindex="-1" href="/docs/glossary">Glossary</a></li></ul></li><li class="menu__list-item menu__list-item--collapsed"><a class="menu__link menu__link--sublist" href="#!" tabindex="-1">Tools</a><ul class="menu__list"><li class="menu__list-item"><a class="menu__link" tabindex="-1" href="/docs/debugging">Debugging</a></li><li class="menu__list-item"><a class="menu__link" tabindex="-1" href="/docs/dev-options">Developer Options</a></li></ul></li><li class="menu__list-item menu__list-item--collapsed"><a class="menu__link menu__link--sublist" href="#!" tabindex="-1">Contributing</a><ul class="menu__list"><li class="menu__list-item"><a class="menu__link" tabindex="-1" href="/docs/contributing">How to Contribute</a></li><li class="menu__list-item"><a class="menu__link" tabindex="-1" href="/docs/community-showcase">Community Showcase</a></li><li class="menu__list-item"><a class="menu__link" tabindex="-1" href="/docs/repo-structure">Repository Structure</a></li></ul></li></ul></li></ul></div></div></div><main class="docMainContainer_3EyW"><div class="container padding-vert--lg docItemWrapper_1EkI"><div class="row"><div class="col docItemCol_2ASc"><div class="docItemContainer_3QWW"><article><header><h1 class="docTitle_1Lrw">Advanced: Writing your own DiffSection</h1></header><div class="markdown"><p>In this document we will describe how to build your own <code>DiffSection</code>. The Sections API already provides two implementations that cover most frequent use cases in <code>SingleComponentSection</code> and <code>DataDiffSection</code>. <strong>You should write your own <code>DiffSection</code> if the given implementations do not suffice for your use case</strong>, as the complexity and chances of introducing subtle errors are both high.</p><h2><a aria-hidden="true" tabindex="-1" class="anchor enhancedAnchor_2cZh" id="diffsectionspec"></a>DiffSectionSpec<a aria-hidden="true" tabindex="-1" class="hash-link" href="#diffsectionspec" title="Direct link to heading">#</a></h2><p>A <em>diff section spec</em> defines a section that explicitly outputs insert, update, and remove changes on the section hierarchy.</p><p>Diff section specs explicitly manage insertions, removals, and updates that a section performs whenever its states and props change.  You will find Diff Sections at the leaves of every section tree as they are the sections that actually specify the changes to be made to a list.</p><p>One example where you might want a custom diff section is if you receive the data you want to display in the form of incremental updates or diffs. This might happen if you&#x27;re using a specialised diffing algorithm to process your data.</p><div class="admonition admonition-note alert alert--secondary"><div class="admonition-heading"><h5><span class="admonition-icon"><svg xmlns="http://www.w3.org/2000/svg" width="14" height="16" viewBox="0 0 14 16"><path fill-rule="evenodd" d="M6.3 5.69a.942.942 0 0 1-.28-.7c0-.28.09-.52.28-.7.19-.18.42-.28.7-.28.28 0 .52.09.7.28.18.19.28.42.28.7 0 .28-.09.52-.28.7a1 1 0 0 1-.7.3c-.28 0-.52-.11-.7-.3zM8 7.99c-.02-.25-.11-.48-.31-.69-.2-.19-.42-.3-.69-.31H6c-.27.02-.48.13-.69.31-.2.2-.3.44-.31.69h1v3c.02.27.11.5.31.69.2.2.42.31.69.31h1c.27 0 .48-.11.69-.31.2-.19.3-.42.31-.69H8V7.98v.01zM7 2.3c-3.14 0-5.7 2.54-5.7 5.68 0 3.14 2.56 5.7 5.7 5.7s5.7-2.55 5.7-5.7c0-3.15-2.56-5.69-5.7-5.69v.01zM7 .98c3.86 0 7 3.14 7 7s-3.14 7-7 7-7-3.12-7-7 3.14-7 7-7z"></path></svg></span>note</h5></div><div class="admonition-content"><p><code>DataDiffSection</code> utilises a familiar Android&#x27;s <a href="https://developer.android.com/reference/android/support/v7/util/DiffUtil.html" target="_blank" rel="noopener noreferrer">DiffUtil</a>.</p></div></div><p>Let&#x27;s use the example of <a href="/javadoc/com/facebook/litho/sections/common/SingleComponentSection.html" target="_blank" rel="noopener noreferrer">SingleComponentSection</a> to describe how to write diff section specs. Here is a snippet of <code>SingleComponentSectionSpec</code>:</p><div class="mdxCodeBlock_1XEh"><div class="codeBlockContent_1u-d"><button type="button" aria-label="Copy code to clipboard" class="copyButton_10dd">Copy</button><div tabindex="0" class="prism-code language-java codeBlock_3iAC"><div class="codeBlockLines_b7E3" style="color:#393A34;background-color:#f6f8fa"><div class="token-line" style="color:#393A34"><span class="token annotation punctuation" style="color:#393A34">@DiffSectionSpec</span><span class="token plain"></span></div><div class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token keyword" style="color:#00009f">class</span><span class="token plain"> </span><span class="token class-name">SingleComponentSectionSpec</span><span class="token plain"> </span><span class="token punctuation" style="color:#393A34">{</span><span class="token plain"></span></div><div class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block">
</span></div><div class="token-line" style="color:#393A34"><span class="token plain">  </span><span class="token annotation punctuation" style="color:#393A34">@OnDiff</span><span class="token plain"></span></div><div class="token-line" style="color:#393A34"><span class="token plain">  </span><span class="token keyword" style="color:#00009f">static</span><span class="token plain"> </span><span class="token keyword" style="color:#00009f">void</span><span class="token plain"> </span><span class="token function" style="color:#d73a49">onCreateChangeSet</span><span class="token punctuation" style="color:#393A34">(</span><span class="token plain"></span></div><div class="token-line" style="color:#393A34"><span class="token plain">      </span><span class="token class-name">SectionContext</span><span class="token plain"> c</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"></span></div><div class="token-line" style="color:#393A34"><span class="token plain">      </span><span class="token class-name">ChangeSet</span><span class="token plain"> changeSet</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"></span></div><div class="token-line" style="color:#393A34"><span class="token plain">      </span><span class="token annotation punctuation" style="color:#393A34">@Prop</span><span class="token plain"> </span><span class="token class-name">Diff</span><span class="token generics punctuation" style="color:#393A34">&lt;</span><span class="token generics class-name">Component</span><span class="token generics punctuation" style="color:#393A34">&gt;</span><span class="token plain"> component</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"></span></div><div class="token-line" style="color:#393A34"><span class="token plain">      </span><span class="token punctuation" style="color:#393A34">.</span><span class="token punctuation" style="color:#393A34">.</span><span class="token punctuation" style="color:#393A34">.</span><span class="token punctuation" style="color:#393A34">)</span><span class="token plain"> </span><span class="token punctuation" style="color:#393A34">{</span><span class="token plain"></span></div><div class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block">
</span></div><div class="token-line" style="color:#393A34"><span class="token plain">    </span><span class="token keyword" style="color:#00009f">if</span><span class="token plain"> </span><span class="token punctuation" style="color:#393A34">(</span><span class="token plain">component</span><span class="token punctuation" style="color:#393A34">.</span><span class="token function" style="color:#d73a49">getNext</span><span class="token punctuation" style="color:#393A34">(</span><span class="token punctuation" style="color:#393A34">)</span><span class="token plain"> </span><span class="token operator" style="color:#393A34">==</span><span class="token plain"> </span><span class="token keyword" style="color:#00009f">null</span><span class="token punctuation" style="color:#393A34">)</span><span class="token plain"> </span><span class="token punctuation" style="color:#393A34">{</span><span class="token plain"></span></div><div class="token-line" style="color:#393A34"><span class="token plain">      changeSet</span><span class="token punctuation" style="color:#393A34">.</span><span class="token function" style="color:#d73a49">delete</span><span class="token punctuation" style="color:#393A34">(</span><span class="token number" style="color:#36acaa">0</span><span class="token punctuation" style="color:#393A34">)</span><span class="token punctuation" style="color:#393A34">;</span><span class="token plain"></span></div><div class="token-line" style="color:#393A34"><span class="token plain">    </span><span class="token punctuation" style="color:#393A34">}</span><span class="token plain"> </span><span class="token keyword" style="color:#00009f">else</span><span class="token plain"> </span><span class="token keyword" style="color:#00009f">if</span><span class="token plain"> </span><span class="token punctuation" style="color:#393A34">(</span><span class="token plain">component</span><span class="token punctuation" style="color:#393A34">.</span><span class="token function" style="color:#d73a49">getPrevious</span><span class="token punctuation" style="color:#393A34">(</span><span class="token punctuation" style="color:#393A34">)</span><span class="token plain"> </span><span class="token operator" style="color:#393A34">==</span><span class="token plain"> </span><span class="token keyword" style="color:#00009f">null</span><span class="token punctuation" style="color:#393A34">)</span><span class="token plain"> </span><span class="token punctuation" style="color:#393A34">{</span><span class="token plain"></span></div><div class="token-line" style="color:#393A34"><span class="token plain">      changeSet</span><span class="token punctuation" style="color:#393A34">.</span><span class="token function" style="color:#d73a49">insert</span><span class="token punctuation" style="color:#393A34">(</span><span class="token plain"></span></div><div class="token-line" style="color:#393A34"><span class="token plain">          </span><span class="token number" style="color:#36acaa">0</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"></span></div><div class="token-line" style="color:#393A34"><span class="token plain">          </span><span class="token class-name">ComponentRenderInfo</span><span class="token punctuation" style="color:#393A34">.</span><span class="token function" style="color:#d73a49">create</span><span class="token punctuation" style="color:#393A34">(</span><span class="token punctuation" style="color:#393A34">)</span><span class="token plain"></span></div><div class="token-line" style="color:#393A34"><span class="token plain">              </span><span class="token punctuation" style="color:#393A34">.</span><span class="token function" style="color:#d73a49">component</span><span class="token punctuation" style="color:#393A34">(</span><span class="token plain">component</span><span class="token punctuation" style="color:#393A34">.</span><span class="token function" style="color:#d73a49">getNext</span><span class="token punctuation" style="color:#393A34">(</span><span class="token punctuation" style="color:#393A34">)</span><span class="token punctuation" style="color:#393A34">)</span><span class="token plain"></span></div><div class="token-line" style="color:#393A34"><span class="token plain">              </span><span class="token punctuation" style="color:#393A34">.</span><span class="token punctuation" style="color:#393A34">.</span><span class="token punctuation" style="color:#393A34">.</span><span class="token plain"></span></div><div class="token-line" style="color:#393A34"><span class="token plain">              </span><span class="token punctuation" style="color:#393A34">.</span><span class="token function" style="color:#d73a49">build</span><span class="token punctuation" style="color:#393A34">(</span><span class="token punctuation" style="color:#393A34">)</span><span class="token punctuation" style="color:#393A34">)</span><span class="token punctuation" style="color:#393A34">;</span><span class="token plain"></span></div><div class="token-line" style="color:#393A34"><span class="token plain">    </span><span class="token punctuation" style="color:#393A34">}</span><span class="token plain"> </span><span class="token keyword" style="color:#00009f">else</span><span class="token plain"> </span><span class="token punctuation" style="color:#393A34">{</span><span class="token plain"></span></div><div class="token-line" style="color:#393A34"><span class="token plain">      changeSet</span><span class="token punctuation" style="color:#393A34">.</span><span class="token function" style="color:#d73a49">update</span><span class="token punctuation" style="color:#393A34">(</span><span class="token plain"></span></div><div class="token-line" style="color:#393A34"><span class="token plain">          </span><span class="token number" style="color:#36acaa">0</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"></span></div><div class="token-line" style="color:#393A34"><span class="token plain">          </span><span class="token class-name">ComponentRenderInfo</span><span class="token punctuation" style="color:#393A34">.</span><span class="token function" style="color:#d73a49">create</span><span class="token punctuation" style="color:#393A34">(</span><span class="token punctuation" style="color:#393A34">)</span><span class="token plain"></span></div><div class="token-line" style="color:#393A34"><span class="token plain">              </span><span class="token punctuation" style="color:#393A34">.</span><span class="token function" style="color:#d73a49">component</span><span class="token punctuation" style="color:#393A34">(</span><span class="token plain">component</span><span class="token punctuation" style="color:#393A34">.</span><span class="token function" style="color:#d73a49">getNext</span><span class="token punctuation" style="color:#393A34">(</span><span class="token punctuation" style="color:#393A34">)</span><span class="token punctuation" style="color:#393A34">)</span><span class="token plain"></span></div><div class="token-line" style="color:#393A34"><span class="token plain">              </span><span class="token punctuation" style="color:#393A34">.</span><span class="token punctuation" style="color:#393A34">.</span><span class="token punctuation" style="color:#393A34">.</span><span class="token plain"></span></div><div class="token-line" style="color:#393A34"><span class="token plain">              </span><span class="token punctuation" style="color:#393A34">.</span><span class="token function" style="color:#d73a49">build</span><span class="token punctuation" style="color:#393A34">(</span><span class="token punctuation" style="color:#393A34">)</span><span class="token punctuation" style="color:#393A34">)</span><span class="token punctuation" style="color:#393A34">;</span><span class="token plain"></span></div><div class="token-line" style="color:#393A34"><span class="token plain">    </span><span class="token punctuation" style="color:#393A34">}</span><span class="token plain"></span></div><div class="token-line" style="color:#393A34"><span class="token plain">  </span><span class="token punctuation" style="color:#393A34">}</span><span class="token plain"></span></div><div class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token punctuation" style="color:#393A34">}</span></div></div></div></div></div><p>As you can see, diff section specs use the <code>@DiffSectionSpec</code> annotation. Implementing a diff section spec requires little boilerplate. You only have to write one method annotated with <code>@OnDiff</code>.</p><p>The method annotated with <code>@OnDiff</code> must have as its first and second argument a <a href="/javadoc/com/facebook/litho/sections/SectionContext.html" target="_blank" rel="noopener noreferrer">SectionContext</a> and a <a href="/javadoc/com/facebook/litho/sections/ChangeSet.html" target="_blank" rel="noopener noreferrer">ChangeSet</a> respectively. Following these two arguments, your <code>@OnDiff</code> method can also accept any number of arguments annotated with <code>@Prop</code> or <code>@State</code>.</p><p>These props and state have a special type: <code>Diff&lt;T&gt;</code>.  If your prop is defined in another annotated method like <code>@Prop String prop1</code>, it must be defined as <code>@Prop Diff&lt;String&gt; prop1</code> when being used in the <code>@OnDiff</code> method. The reason for this <code>Diff&lt;T&gt;</code> type wrapper is so we can compare previous prop values with new prop values when computing changes.</p><h2><a aria-hidden="true" tabindex="-1" class="anchor enhancedAnchor_2cZh" id="making-changes-to-the-list-with-changeset"></a>Making changes to the list with ChangeSet<a aria-hidden="true" tabindex="-1" class="hash-link" href="#making-changes-to-the-list-with-changeset" title="Direct link to heading">#</a></h2><p>The <code>ChangeSet</code> argument of the <code>@OnDiff</code> method is used by the Diff section spec to specify how the section changes in response to new data.  The <code>@OnDiff</code> method will always be called with the current <em>and previous</em> props and state values (hence the <code>Diff&lt;T&gt;</code> type). The expectation is that you&#x27;d be able to use the current and previous values to determine how to update the items being rendered.</p><p>When you&#x27;ve determined what changes need to be made, you should call the corresponding method on the <code>ChangeSet</code> object. These methods correspond to <code>RecyclerView.Adapter</code>&#x27;s <code>notifyItem*</code> methods. You can get a quick idea of how this works in <a href="https://github.com/facebook/litho/blob/d766e3b4965edf84eda0090f58d0020aa302d650/litho-sections-core/src/main/java/com/facebook/litho/sections/common/SingleComponentSectionSpec.java#L25" target="_blank" rel="noopener noreferrer">SingleComponentSectionSpec#onDiff</a>:</p><ul><li>If we don&#x27;t have a new <code>Component</code> (<code>component.getNext() == null</code>) then we want to change the list by removing that row.</li><li>Else if we have a new <code>Component</code> and no previous component, we want to insert a new row.</li><li>If both an old component and a new component exists, we just want to update that row to the new component.</li></ul><p>Note, the indexes used in the <code>ChangeSet</code> method calls, <em>they&#x27;re relative to the current section</em>.  Index 0 in <code>SingleComponentSectionSpec</code> might actually be index 100 in the final list depending on the section hierarchy. The framework will take care of translating local indexes to global indexes when processing the <code>ChangeSet</code>.</p></div></article><div class="margin-vert--xl"><div class="row"><div class="col"><a href="https://github.com/facebook/litho/edit/master/website/docs/sections/diff-sections.md" target="_blank" rel="noreferrer noopener"><svg fill="currentColor" height="1.2em" width="1.2em" preserveAspectRatio="xMidYMid meet" viewBox="0 0 40 40" style="margin-right:0.3em;vertical-align:sub"><g><path d="m34.5 11.7l-3 3.1-6.3-6.3 3.1-3q0.5-0.5 1.2-0.5t1.1 0.5l3.9 3.9q0.5 0.4 0.5 1.1t-0.5 1.2z m-29.5 17.1l18.4-18.5 6.3 6.3-18.4 18.4h-6.3v-6.2z"></path></g></svg>Edit this page</a></div></div></div><div class="margin-vert--lg"><nav class="pagination-nav" aria-label="Blog list page navigation"><div class="pagination-nav__item"><a class="pagination-nav__link" href="/docs/sections/view-support"><div class="pagination-nav__sublabel">Previous</div><div class="pagination-nav__label">« Advanced: Mixing with Android Views</div></a></div><div class="pagination-nav__item pagination-nav__item--next"><a class="pagination-nav__link" href="/docs/sections/architecture"><div class="pagination-nav__sublabel">Next</div><div class="pagination-nav__label">Internal 🏗: Sections implementation architecture »</div></a></div></nav></div></div></div><div class="col col--3"><div class="tableOfContents_3SO_"><ul class="table-of-contents table-of-contents__left-border"><li><a href="#diffsectionspec" class="table-of-contents__link">DiffSectionSpec</a></li><li><a href="#making-changes-to-the-list-with-changeset" class="table-of-contents__link">Making changes to the list with ChangeSet</a></li></ul></div></div></div></div></main></div></div><footer class="footer footer--dark"><div class="container"><div class="row footer__links"><div class="col footer__col"><h4 class="footer__title">Learn</h4><ul class="footer__items"><li class="footer__item"><a class="footer__link-item" href="/docs/getting-started">Getting Started</a></li><li class="footer__item"><a href="/javadoc" target="_blank" rel="noopener noreferrer" class="footer__link-item">API</a></li></ul></div><div class="col footer__col"><h4 class="footer__title">Open Source</h4><ul class="footer__items"><li class="footer__item"><a class="footer__link-item" href="/docs/contributing">How To Contribute</a></li><li class="footer__item"><a href="https://opensource.facebook.com" target="_blank" rel="noopener noreferrer" class="footer__link-item">Open Source Projects</a></li></ul></div><div class="col footer__col"><h4 class="footer__title">Legal</h4><ul class="footer__items"><li class="footer__item"><a href="https://opensource.facebook.com/legal/privacy" target="_blank" rel="noopener noreferrer" class="footer__link-item">Privacy</a></li><li class="footer__item"><a href="https://opensource.facebook.com/legal/terms" target="_blank" rel="noopener noreferrer" class="footer__link-item">Terms</a></li></ul></div><div class="col footer__col"><h4 class="footer__title">Social</h4><ul class="footer__items"><li class="footer__item"><a href="https://github.com/facebook/litho" target="_blank" rel="noopener noreferrer" class="footer__link-item">Github</a></li><li class="footer__item"><a href="https://twitter.com/fblitho" target="_blank" rel="noopener noreferrer" class="footer__link-item">Twitter</a></li></ul></div></div><div class="text--center"><div class="margin-bottom--sm"><a href="https://opensource.facebook.com" target="_blank" rel="noopener noreferrer" class="footerLogoLink_1zJy"><img class="footer__logo" alt="Facebook Open Source Logo" src="/images/oss_logo.png"></a></div><div>Copyright © 2021 Facebook, Inc.</div></div></div></footer></div>
<script src="/styles.9856b768.js"></script>
<script src="/runtime~main.3b77bac1.js"></script>
<script src="/main.dad78cf1.js"></script>
<script src="/1.bb7fa744.js"></script>
<script src="/2.9388d11f.js"></script>
<script src="/101.46985c7a.js"></script>
<script src="/104.bb474256.js"></script>
<script src="/935f2afb.e9c270b9.js"></script>
<script src="/17896441.e778f366.js"></script>
<script src="/2df85be4.165ba088.js"></script>
</body>
</html>